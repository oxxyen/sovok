# oxxye_nime — Парсер и валидатор бесплатных VPN-конфигураций

Проект `oxxye_nime` — небольшой, быстрый и удобный инструмент на C для
парсинга и валидации публичных подписок VPN-серверов (форматы Shadowsocks, Vmess, Trojan).
Он загружает подписку (URL или локальный файл), преобразует записи в JSON
и при желании выполняет сетевую валидацию (DNS + TCP connect с таймаутом и измерением задержки).

Это полезно для анализа больших списков, отбора рабочих прокси и создания понятных отчётов в JSON/YAML.

## Основные возможности

- Поддерживаемые форматы: `ss://`, `vmess://`, `trojan://` и произвольные строки (как `raw`).
- Пакетная обработка подписок: загрузка по URL с помощью libcurl.
- Надёжный парсинг и безопасное декодирование (URL-unescape, base64).
- Валидация: DNS-разрешение и TCP connect с настраиваемым таймаутом, измерение latency.
- Генерация читаемых отчётов: pretty JSON и простая YAML-версия.
- Опциональная интеграция с Redis: добавление рабочих серверов в множество (SADD).

## Требования

- ОС: POSIX-совместимая (Linux, macOS).
- Компилятор: `gcc` (поддержка C11).
- Библиотеки:
  - `libcurl` (curl) — для скачивания подписок и URL-decode
  - `cJSON` — для работы с JSON
  - `pthread` — для опционального потокового валидатора

Установите зависимости в Debian/Ubuntu:

```bash
sudo apt update
sudo apt install build-essential libcurl4-openssl-dev libcjson-dev
```

## Сборка

В корне проекта запустите:

```bash
gcc -std=c11 -O2 main.c -o oxxye_nime -lcurl -lcjson -pthread
```

Или используйте ваш скрипт сборки (если есть `build.sh`):

```bash
./build.sh
```

## Быстрый старт — парсинг и генерация JSON

1. Скачайте подписку или укажите URL при запуске программы.
2. Выберите опцию парсинга (парсер автоматически распознаёт `ss://`, `vmess://`, `trojan://`).
3. Получите файл `vpn_configs.json` (можно указать своё имя).

Пример:

```bash
./oxxye_nime
# Затем следуйте подсказкам: введите URL или оставьте поле пустым для использования дефолтного.
```

Результатом будет JSON с массивом `configs` — каждая запись содержит разобранные поля и оригинальную строку (`raw`) для нераспознанных форматов.

## Валидация конфигураций

Программа умеет проверять доступность серверов: выполняется DNS-разрешение и неполный TCP-handshake (connect) с таймаутом.
Результаты валидации добавляются к каждой записи в поле `valid`, `reachable`, `latency_ms`, `network_error`.

После валидации создаётся подробный отчёт в JSON (и параллельно — простая YAML-версия).

## Переменные окружения и опции

- `ENABLE_REDIS` — если задана (любое ненулевое значение), включает попытки добавления рабочих серверов в Redis.
- `REDIS_HOST` — хост Redis (по умолчанию `127.0.0.1`).
- `REDIS_PORT` — порт Redis (по умолчанию `6379`).
- `REDIS_KEY` — ключ множества Redis для рабочих серверов (по умолчанию `working_vpn`).
- `VALIDATOR_WORKERS` — количество потоков валидатора (по умолчанию подбирается автоматически, ограничено).

Пример запуска с Redis:

```bash
ENABLE_REDIS=1 REDIS_HOST=127.0.0.1 REDIS_PORT=6379 VALIDATOR_WORKERS=8 ./oxxye_nime
```

Примечание: встроенный Redis-клиент реализован в проекте простым RESP-исполнением через TCP.
Для продакшна рекомендуется использовать готовую клиентскую библиотеку (hiredis) или внешнюю очередь/батчер.

## Формат отчёта (пример полей)

- `name` — название профиля, если задано (из комментария или поля `ps` в vmess).
- `type` — `ss` | `vmess` | `trojan` | `unknown`.
- `server` / `port` — целевой хост и порт.
- `valid` — логическая отметка, пройдены ли базовые проверки полей.
- `reachable` — успешен ли TCP connect (true/false).
- `latency_ms` — измеренная задержка (при успешном подключении).
- `network_error` — текст ошибки сети при неуспехе.
- `redis` — статус добавления в Redis (`added`/`failed`) когда Redis включён.

Пример короткого JSON-элемента:

```json
{
  "name": "my server",
  "type": "ss",
  "server": "1.2.3.4",
  "port": 8388,
  "valid": true,
  "reachable": true,
  "latency_ms": 45.32
}
```

## Безопасность и рекомендации

- Никогда не запускайте программу с привилегиями root, если этого не требует окружение.
- Проверяйте происхождение подписок — публичные списки могут содержать вредоносные или приватные адреса.
- По умолчанию валидатор защищает от попадания приватных IPv4-адресов в рабочие множества Redis.
- Для массовой валидации (тысячи записей) увеличьте число рабочих потоков и используйте отдельный Redis-писатель или батчинг.

## Отладка и логирование

- В выводе программы печатаются ключевые шаги и ошибки при скачивании/разборе/валидации.
- Для детальной отладки можно добавить дополнительные debug-печати в `main.c` (функции сетевой проверки).

## Что можно улучшить

- Заменить встроенный RESP-клиент на `hiredis` для надёжности и производительности.
- Добавить кеширование DNS и ограничение частоты проверок для одной и той же подсети.
- Поддержать больше форматов подписок и расширенные правила валидации (TLS/ALPN/handshake проверки).
- Добавить unit-тесты и CI-пайплайн.

## Структура репозитория

- `main.c` — основной исходный файл (парсер, валидатор, отчёты).
- `build.sh` — (опционально) вспомогательный скрипт сборки.
- `vpn_raw.txt`, `vpn_configs.json`, `vpn_validation_report.json` — пример файлов, которые генерируются/используются.

## Лицензия

Этот проект — личный/учебный инструмент. При необходимости добавьте файл `LICENSE` с желаемой лицензией.

---

